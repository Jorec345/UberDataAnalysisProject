select(9,10,13,12,17,19,20,21,22)%>%
filter(Year == "2017")
group_by(dayofweek)%>%
summarise(No.OfOrders = n()) %>%
arrange(desc(No.OfOrders))
New.UberData%>%
mutate(FullNames = paste(`First Name`,`Last Name`))%>%
select(9,10,13,12,17,19,20,21,22)%>%
filter(Year == "2017")%>%
group_by(dayofweek)%>%
summarise(No.OfOrders = n()) %>%
arrange(desc(No.OfOrders))
New.UberData%>%
mutate(FullNames = paste(`First Name`,`Last Name`))%>%
select(9,10,13,12,17,19,20,21,22)%>%
filter(Year == "2018")%>%
group_by(dayofweek)%>%
summarise(No.OfOrders = n()) %>%
arrange(desc(No.OfOrders))
New.UberData%>%
mutate(FullNames = paste(`First Name`,`Last Name`))%>%
select(9,10,13,12,17,19,20,21,22)%>%
group_by(dayofweek,Year)%>%
summarise(No.OfOrders = n()) %>%
arrange(desc(No.OfOrders))
New.UberData%>%
mutate(FullNames = paste(`First Name`,`Last Name`))%>%
select(9,10,13,12,17,19,20,21,22)%>%
filter(Year == "2018")%>%
group_by(dayofweek)%>%
summarise(No.OfOrders = n()) %>%
arrange(desc(No.OfOrders))
###analysis by time of order
AnalysisByTime <-
New.UberData%>%
mutate(FullNames = paste(`First Name`,`Last Name`))%>%
select(9,10,13,12,17,19,20,21,22)%>%
group_by(hours)%>%
summarise(No.OfOrders = n()) %>%
arrange(desc(No.OfOrders))
##Visualizing analysis by time of order using a bar chart
ggplot(data = AnalysisByTime, aes(x = hours, y = No.OfOrders))+
geom_bar(stat = 'identity', aes(fill = hours))+
ggtitle("Analysis by time of order")
##Visualization using pie charts
pie(YearlyData$summedTotals,labels = YearlyData$Year,
main = "Yearly Expenditure on Uber", col = c("red","blue"))
##barplot visualization
barplot(YearlyData$summedTotals, main = "Yearly Expenditure on Uber", ylab = "summedTotals",
xlab = "Year", horiz = F,
col = c("red","Blue")
,border = "green")
##Visualization using pie charts
pie(YearlyData$summedTotals,labels = YearlyData$Year,
main = "Yearly Expenditure on Uber", col = c("red","blue"))
##Visualization using pie charts
pie(YearlyData$summedTotals,labels = YearlyData$Year,
main = "Yearly Expenditure on Uber", col = c("red","blue"))
library(dplyr)
library(readr)
library(stats)
library(chron)
library(tidyverse)
library(data.table)
library(hrbrthemes)
library(tidyr)
library(viridis)
library(ggpubr)
library(psych)
library(lubridate)
##consuming in the 2018 Data
UberData <- read.csv("UberData.csv",header = TRUE, stringsAsFactors = FALSE)
##cleaning and processing the Data my data
New.UberData <-
UberData%>%
mutate(Duration = as.numeric(Duration..min.),
GST = as.numeric(GST.amount),
datetime = paste(Request.Date..Local.,Request.Time..Local.),
"Request Time" = strptime(datetime, format = "%m/%d/%Y %H:%M"),
"Date Requested" = as.IDate(`Request Time`),
dayofweek = weekdays(`Date Requested`),
"Time Requested" = format(strptime(`Request.Time..Local.`,"%I:%M %p"),
format = "%H:%M"),
hours = as.numeric(format(strptime(`Request.Time..Local.`,"%I:%M %p"),
format = "%H")),
Year = as.numeric(format(`Date Requested`, "%Y")),
Months = factor(months(as.Date(`Date Requested`)),
levels = month.name))%>%
select(-c(1,2,9,10,20,21))%>%
rename("First Name" = First.Name,
"Last Name" = Last.Name,
"Employee ID" = Employee.ID,
"Distance" = Distance..mi.,
"Service and Tech Fees"= Service.and.Technology.Fee,
"Dropoff Address"= Dropoff.Address,
"Pickup Address" = Pickup.Address,
"Expense Code"= Expense.Code,
"Expense Memo"= Expense.Memo,
"Fare" = Fare.in.KES,
"Charges" = Total.Charge.in.KES)
##handling missing values by replacing them with 0
New.UberData$GST[which(is.na(New.UberData$GST))] <- 0
##Exploratory Data Analysis
##analysis by year
YearlyData <-
New.UberData%>%
mutate(Year = as.numeric(format(`Date Requested`, "%Y")))%>%
select(Charges,Months,Year)%>%
group_by(Year)%>%
summarise(summedTotals = sum(Charges))
library(dplyr)
library(readr)
library(stats)
library(chron)
library(tidyverse)
library(data.table)
library(hrbrthemes)
library(tidyr)
library(viridis)
library(ggpubr)
library(psych)
library(lubridate)
##consuming in the 2018 Data
UberData <- read.csv("UberData.csv",header = TRUE, stringsAsFactors = FALSE)
##cleaning and processing the Data my data
New.UberData <-
UberData%>%
mutate(Duration = as.numeric(Duration..min.),
GST = as.numeric(GST.amount),
datetime = paste(Request.Date..Local.,Request.Time..Local.),
"Request Time" = strptime(datetime, format = "%m/%d/%Y %H:%M"),
"Date Requested" = as.IDate(`Request Time`),
dayofweek = weekdays(`Date Requested`),
"Time Requested" = format(strptime(`Request.Time..Local.`,"%I:%M %p"),
format = "%H:%M"),
hours = as.numeric(format(strptime(`Request.Time..Local.`,"%I:%M %p"),
format = "%H")),
Year = as.numeric(format(`Date Requested`, "%Y")),
Months = factor(months(as.Date(`Date Requested`)),
levels = month.name))%>%
select(-c(1,2,9,10,20,21))%>%
rename("First Name" = First.Name,
"Last Name" = Last.Name,
"Employee ID" = Employee.ID,
"Distance" = Distance..mi.,
"Service and Tech Fees"= Service.and.Technology.Fee,
"Dropoff Address"= Dropoff.Address,
"Pickup Address" = Pickup.Address,
"Expense Code"= Expense.Code,
"Expense Memo"= Expense.Memo,
"Fare" = Fare.in.KES,
"Charges" = Total.Charge.in.KES)
##handling missing values by replacing them with 0
New.UberData$GST[which(is.na(New.UberData$GST))] <- 0
##Exploratory Data Analysis
##analysis by year
YearlyData <-
New.UberData%>%
mutate(Year = as.numeric(format(`Date Requested`, "%Y")))%>%
select(Charges,Months,Year)%>%
group_by(Year)%>%
summarise(summedTotals = sum(Charges))
##Visualization using pie charts
pie(YearlyData$summedTotals,labels = YearlyData$Year,
main = "Yearly Expenditure on Uber", col = c("red","blue"))
ggplot(YearlyData, aes(x = 1, weight = summedTotals, fill = Year)) +
geom_bar(width = 1, position = "stack")
ggplot(YearlyData, aes(x = 1, weight = summedTotals, fill = Year)) +
geom_bar(width = 1, position = "stack") +
coord_polar(theta = "y") +
geom_text(aes(x = 1.3, y = midpoint, label = label)) +
theme_nothing()
library(ggmap)
install.packages(ggmap)
##Exploratory Data Analysis
##analysis by year
YearlyData <-
New.UberData%>%
mutate(Year = as.numeric(format(`Date Requested`, "%Y")))%>%
select(Charges,Months,Year)%>%
group_by(Year)%>%
summarise(summedTotals = sum(Charges))
YearlyData
##Visualization using pie charts
pie(YearlyData$summedTotals,labels = YearlyData$Year,
main = "Yearly Expenditure on Uber", col = c("red","blue"))
###analysis of expenditure trends by months
MonthlyData <-
New.UberData%>%
mutate(Year = as.numeric(format(`Date Requested`, "%Y")),
Months = factor(months(as.Date(`Date Requested`)),
levels = month.name))%>%
select(Charges,Months,Year)%>%
group_by(Months, Year)%>%
summarise(MonthlyTotals = sum(Charges))
##monthly expenditure trends show no seasonality.
ggplot(data = MonthlyData, aes(x = Months, y = MonthlyTotals)) +
geom_bar(stat = "identity", alpha = 0.7) +
facet_grid(. ~Year)+
labs(x = "Months", y = "Uber Expediture", title = "Monthly Expenditure on Uber") +
theme(plot.title = element_text(hjust = 0.5),
axis.title.x = element_text(face="bold", colour="darkgreen", size = 12),
axis.title.y = element_text(face="bold", colour="darkgreen", size = 12),
legend.title = element_text(face="bold", size = 10),
strip.background = element_rect(fill="lightblue", colour="black", size=1),
strip.text = element_text(face="bold", size=rel(1.2)))
##Employee STATS Analysis
##Total Number of employee uber orders by Months
EmployeeMonthlyFreq <-
New.UberData%>%
mutate(Year = as.numeric(format(`Date Requested`, "%Y")),
Months = factor(months(as.Date(`Date Requested`)),
levels = month.name),
FullNames = paste(`First Name`,`Last Name`))%>%
select(9,12,17,19,20,21,22)%>%
group_by(Months,Year)%>%
count()%>%
rename(Freq = n)
EmployeeMonthlyFreq
##Visualizing Employee stats with a histogram
ggplot(EmployeeMonthlyFreq,aes(fill = Months,x = Months,y = Freq))+
geom_histogram(position = "dodge",stat = "identity")+
facet_grid(.~Year)+
ggtitle("Frequency of Uber orders")
##individual employee total orders
EmployeeYearlyExpense <-
New.UberData%>%
mutate(Year = as.numeric(format(`Date Requested`, "%Y")),
Months = factor(months(as.Date(`Date Requested`)),
levels = month.name),
FullNames = paste(`First Name`,`Last Name`))%>%
select(9,10,13,12,17,19,20,21,22)%>%
group_by(FullNames,Year)%>%
count()%>%
arrange(desc(n))
EmployeeYearlyExpense
##individual employee expenses
EmployeeYearlyExpense <-
New.UberData%>%
mutate(Year = as.numeric(format(`Date Requested`, "%Y")),
Months = factor(months(as.Date(`Date Requested`)),
levels = month.name),
FullNames = paste(`First Name`,`Last Name`))%>%
select(9,10,13,12,17,19,20,21,22)%>%
group_by(FullNames,Year)%>%
summarise(Individual_Charges = sum(Charges))%>%
arrange(desc(Individual_Charges))
EmployeeYearlyExpense
###analysis by time of order
AnalysisByTime <-
New.UberData%>%
mutate(FullNames = paste(`First Name`,`Last Name`))%>%
select(9,10,13,12,17,19,20,21,22)%>%
group_by(hours)%>%
summarise(No.OfOrders = n()) %>%
arrange(desc(No.OfOrders))
##Visualizing analysis by time of order using a bar chart
ggplot(data = AnalysisByTime, aes(x = hours, y = No.OfOrders))+
geom_bar(stat = 'identity', aes(fill = hours))+
ggtitle("Analysis by time of order")
New.UberData%>%
mutate(FullNames = paste(`First Name`,`Last Name`))%>%
select(9,10,13,12,17,19,20,21,22)%>%
filter(Year == "2018")%>%
group_by(dayofweek)%>%
summarise(No.OfOrders = n()) %>%
arrange(desc(No.OfOrders))
##Employee analysis by time of order and amount paid
Order_Amount <-
New.UberData%>%
select(Charges,hours)
cor(Order_Amount)
###consuming in the departments data
EmployeeData <- read.csv("EmployeeNames.csv",header=TRUE)
EmployeeYearlyExpense$FullNames
##creating a forloop that matches each name to the department.
codes = EmployeeData$Employee.Name
Department <- vector(mode="character", length=nrow(EmployeeYearlyExpense))
for (i in 1:nrow(EmployeeYearlyExpense)) {
idx = match(EmployeeYearlyExpense$FullNames[i], codes)
Department[i] <- EmployeeData$Department[idx]
}
###analysis of Total spending by department and expense code
DepartExpense <-
cbind(EmployeeYearlyExpense,Department)%>%
rename(Departments = ...5)%>%
group_by(Departments,Year)%>%
summarise(TotalSpending = sum(Individual_Charges))%>%
arrange(desc(TotalSpending))
##creating a forloop that matches each name to the department.
codes = EmployeeData$Employee.Name
Department <- vector(mode="character", length=nrow(EmployeeYearlyExpense))
###analysis of Total spending by department and expense code
DepartExpense <-
cbind(EmployeeYearlyExpense,Department)%>%
rename(Departments = ...4)%>%
group_by(Departments,Year)%>%
summarise(TotalSpending = sum(Individual_Charges))%>%
arrange(desc(TotalSpending))
##visualising spending by expense code
ggplot(data = DepartExpense, aes(x = Departments, y = TotalSpending))+
geom_bar(stat = 'identity', aes(fill = Departments))+
facet_grid(.~Year)+
theme_grey()+
labs(title = 'spending by expense code',
y = 'TotalSpending', x = 'Departments')
DepartExpense
cbind(EmployeeYearlyExpense,Department)%>%
rename(Departments = ...4)%>%
group_by(Departments,Year)
cbind(EmployeeYearlyExpense,Department)%>%
rename(Departments = ...4)%>%
group_by(Departments,Year)%>%
summarise(TotalSpending = sum(Individual_Charges))
##analysis of frequency of order by expense code
AnalysisByexpenseCode <-
New.UberData%>%
mutate(CAPS = toupper(`Expense Code`),
Replaced = str_replace_all(CAPS,fixed(" "), ""),
Replaced2 = str_replace_all(Replaced,
fixed("working late"), "WORKLATE"),
New.ExpenseCode = str_replace_all(Replaced2,
fixed(c("NATIONALBANKKENYATTAAVENUE" = "OFFICEADMIN",
"NSSFSETTLEMENT"   = "OFFICEADMIN",
"NSSF" = "OFFICEADMIN","1517" = "OFFICEADMIN",
"NAKUMATTLIFESTYLE" = "OFFICEADMIN",
"NSSFFOLLOWUP" = "OFFICEADMIN",
"PAYMENTOFPAYEANDNHIF" = "OFFICEADMIN",
"FROMBANKTOOFFICE" = "OFFICEADMIN",
"OFFICEADMINFOLLOWUP" = "OFFICEADMIN",
"FOLLOWUPONOFFICEADMIN" = "OFFICEADMIN",
"CLIENTSUPPORT" = "SUPPORT",
"WORKINGLATE" = "WORKLATE"))))%>%
select(9,20,21,25)%>%
group_by(New.ExpenseCode,Year)%>%
count()
ggplot(data = AnalysisByexpenseCode, aes(x = New.ExpenseCode, y = n))+
geom_bar(stat = 'identity', aes(fill = New.ExpenseCode))+
facet_grid(.~Year)+
theme_grey()+
labs(title = 'frequency of order by expense code',
y = 'Frequency of order', x = 'Expense code')
##predicting annual expense by expense code
model <- lm(formula =  TotalSpending~`Expense Code`, data = DepartExpense)
summary(model)
colnames(New.UberData)
EmployeeYearlyExpense
EmployeeMonthlyFreq
##individual employee expenses
Ind.EmployeeYearlyExpense <-
New.UberData%>%
mutate(Year = as.numeric(format(`Date Requested`, "%Y")),
Months = factor(months(as.Date(`Date Requested`)),
levels = month.name),
FullNames = paste(`First Name`,`Last Name`))%>%
select(9,10,13,12,17,19,20,21,22)%>%
group_by(FullNames,Year)%>%
summarise(Individual_Charges = sum(Charges))%>%
arrange(desc(Individual_Charges))
EmployeeYearlyExpense
##individual employee total orders**
EmployeeYearlyExpense <-
New.UberData%>%
mutate(Year = as.numeric(format(`Date Requested`, "%Y")),
Months = factor(months(as.Date(`Date Requested`)),
levels = month.name),
FullNames = paste(`First Name`,`Last Name`))%>%
select(9,10,13,12,17,19,20,21,22)%>%
group_by(FullNames,Year)%>%
count()%>%
arrange(desc(n))
###consuming in the departments data
EmployeeData <- read.csv("EmployeeNames.csv",header=TRUE)
EmployeeYearlyExpense$FullNames
##creating a forloop that matches each name to the department.
codes = EmployeeData$Employee.Name
Department <- vector(mode="character", length=nrow(EmployeeYearlyExpense))
for (i in 1:nrow(EmployeeYearlyExpense)) {
idx = match(EmployeeYearlyExpense$FullNames[i], codes)
Department[i] <- EmployeeData$Department[idx]
}
###analysis of Total spending by department and expense code****
DepartExpense <-
cbind(EmployeeYearlyExpense,Department)%>%
rename(Departments = ...4)%>%
group_by(Departments,Year)%>%
summarise(TotalSpending = sum(Individual_Charges))%>%
arrange(desc(TotalSpending))
Ind.EmployeeYearlyExpense
##individual employee expenses
EmployeeYearlyExpense <-
New.UberData%>%
mutate(Year = as.numeric(format(`Date Requested`, "%Y")),
Months = factor(months(as.Date(`Date Requested`)),
levels = month.name),
FullNames = paste(`First Name`,`Last Name`))%>%
select(9,10,13,12,17,19,20,21,22)%>%
group_by(FullNames,Year)%>%
summarise(Individual_Charges = sum(Charges))%>%
arrange(desc(Individual_Charges))
New.UberData%>%
mutate(Year = as.numeric(format(`Date Requested`, "%Y")),
Months = factor(months(as.Date(`Date Requested`)),
levels = month.name),
FullNames = paste(`First Name`,`Last Name`))%>%
select(9,10,13,12,17,19,20,21,22)%>%
group_by(FullNames,Year)%>%
count()%>%
arrange(desc(n))
##individual employee total orders**
EmployeeFrequencyofOrder<-
New.UberData%>%
mutate(Year = as.numeric(format(`Date Requested`, "%Y")),
Months = factor(months(as.Date(`Date Requested`)),
levels = month.name),
FullNames = paste(`First Name`,`Last Name`))%>%
select(9,10,13,12,17,19,20,21,22)%>%
group_by(FullNames,Year)%>%
count()%>%
arrange(desc(n))
EmployeeFrequencyofOrder
##individual employee expenses
EmployeeYearlyExpense <-
New.UberData%>%
mutate(Year = as.numeric(format(`Date Requested`, "%Y")),
Months = factor(months(as.Date(`Date Requested`)),
levels = month.name),
FullNames = paste(`First Name`,`Last Name`))%>%
select(9,10,13,12,17,19,20,21,22)%>%
group_by(FullNames,Year)%>%
summarise(Individual_Charges = sum(Charges))%>%
arrange(desc(Individual_Charges))
###consuming in the departments data
EmployeeData <- read.csv("EmployeeNames.csv",header=TRUE)
EmployeeYearlyExpense$FullNames
##creating a forloop that matches each name to the department.
codes = EmployeeData$Employee.Name
Department <- vector(mode="character", length=nrow(EmployeeYearlyExpense))
for (i in 1:nrow(EmployeeYearlyExpense)) {
idx = match(EmployeeYearlyExpense$FullNames[i], codes)
Department[i] <- EmployeeData$Department[idx]
}
###analysis of Total spending by department and expense code****
DepartExpense <-
cbind(EmployeeYearlyExpense,Department)%>%
rename(Departments = ...4)%>%
group_by(Departments,Year)%>%
summarise(TotalSpending = sum(Individual_Charges))%>%
arrange(desc(TotalSpending))
DepartExpense
##visualising spending by expense code
ggplot(data = DepartExpense, aes(x = Departments, y = TotalSpending))+
geom_bar(stat = 'identity', aes(fill = Departments))+
facet_grid(.~Year)+
theme_grey()+
labs(title = 'spending by expense code',
y = 'TotalSpending', x = 'Departments')
YearlyData
ggplot(YearlyData, aes(x= Year, y=summedTotals, fill= summedTotals)) +
geom_bar(width = 1, stat = "identity") +
coord_polar("y", start=0) +
geom_text(aes(
label = percent(col2/sum_of_obsrv )), size=5)
ggplot(YearlyData, aes(x= Year, y=summedTotals, fill= summedTotals)) +
geom_bar(width = 1, stat = "identity") +
coord_polar("y", start=0) +
geom_text(aes(
label = percent(sum(summedTotals)/summedTotals)), size=5)
ggplot(YearlyData, aes(x= Year, y=summedTotals, fill= summedTotals)) +
geom_bar(width = 1, stat = "identity") +
coord_polar("y", start=0)
ggplot(YearlyData, aes(x= Year, y=summedTotals, fill= summedTotals)) +
geom_bar(width = 1, stat = "identity") +
coord_polar("y", start=0) +
geom_text(aes(label = percent(sum(summedTotals)/summedTotals[i])), size=5)
library(ggrepel)
library(forcats)
library(scales)
ggplot(YearlyData, aes(x= Year, y=summedTotals, fill= summedTotals)) +
geom_bar(width = 1, stat = "identity") +
coord_polar("y", start=0) +
geom_text(aes(label = percent(sum(summedTotals)/summedTotals[i])), size=5)
pie <- ggplot(YearlyData, aes(x= Year, y=summedTotals, fill= summedTotals)) +
geom_bar(width = 1, stat = "identity") +
coord_polar("y", start=0) +
geom_text(aes(label = percent(sum(summedTotals)/summedTotals[i])), size=5)
print(pie)
library(ggrepel)
library(forcats)
library(scales)
ggplot(YearlyData, aes(x= Year, y=summedTotals, fill= summedTotals)) +
geom_bar(width = 1, stat = "identity") +
coord_polar("y", start=0) +
geom_text(aes(label = percent(sum(summedTotals)/summedTotals[i])), size=5)
percent(sum(summedTotals)/summedTotals[i]))
ggplot(YearlyData, aes(x= Year, y=summedTotals, fill= summedTotals)) +
geom_bar(width = 1, stat = "identity") +
coord_polar("y", start=0) +
geom_text(aes(label = percent(sum(summedTotals)/summedTotals[i]), size=5))
ggplot(YearlyData, aes(x= summedTotals, y=Year, fill= Year)) +
geom_bar(width = 1, stat = "identity") +
coord_polar("y", start=0)
ggplot(YearlyData, aes(x= summedTotals, y=Year, fill= Year)) +
geom_bar(width = 1, stat = "identity") +
coord_polar("y", start=0) +
geom_text(aes(label = percent(sum(summedTotals)/summedTotals[i]), size=5))
percent(sum(summedTotals)/summedTotals[i])
pie(YearlyData$summedTotals,
labels = YearlyData$Year + percent(sum(summedTotals)/1:length(summedTotals)),
main = "Yearly Expenditure on Uber", col = c("red","blue"))
legend("bottomleft",YearlyData$Year,fill = c("red","blue"))
percent(sum(summedTotals)/1:length(summedTotals))
